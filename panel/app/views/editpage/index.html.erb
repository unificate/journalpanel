<div class="container">
  <h1 class="service-title">Changes</h1>
    <div class="changesTable text-center">
        <% unless @changes.nil? %>
            <table class="table table-hover">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">
                            Change Id
                        </th>
                        <th scope="col">
                            Row Entry Id
                        </th>
                        <th scope="col">
                            Microservice
                        </th>
                        <th scope="col">
                            Table
                        </th>
                        <th scope="col">
                            Old Value
                        </th>
                        <th scope="col">
                            New Value
                        </th>
                        <th scope="col">
                            Created At
                        </th>
                        <th scope="col">
                            User Id
                        </th>
                        <th scope="col">
                            Select
                        </th>
                    </tr>
                </thead>
                <tbody>
                <% @changes.zip(@metadata, @microservice).each do |change, cmd, microservice| %>
                    <tr>
                        <td><%= change.id %></td>
                        <td><%= change.Row_Entry_id %></td>
                        <td><%= microservice.name %></td>
                        <td><%= cmd.Table_Name %></td>
                        <td>
                            <div class="overflow-auto" style="height: 125px">
                                <% stringToJSON(change.old_value).each do |val| %>
                                    <% unless val[0].in? ["id", "created_at", "updated_at"] %>
                                        <%= val[0] + ": " + "\n" %>
                                        <br>
                                        <%= val[1] + "\n" %>
                                        <br>
                                        <br>
                                    <% end %>
                                <% end %>
                            </div>
                        </td>
                        <td>
                            <div class="overflow-auto" style="height: 125px">
                                <% stringToJSON(change.new_value).each_with_index do |val, index| %>
                                    <% unless val[0].in? ["id", "created_at", "updated_at"] %>
                                        <%= val[0] + ": " + "\n" %>
                                        <br>
                                        <%= val[1] + "\n" %>
                                        <br>
                                        <br>
                                    <% end %>
                                <% end %>
                            </div>
                        </td>
                        <td><%= change.created_at %></td>
                        <td><%= change.Users_id %></td>
                        <td><%= check_box_tag('change', change) %></td>
                    </tr>
                <% end %>
                </tbody>
            </table>
        <% end %>
    </div>
</div>


